<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragmentsAdmin/layout}">

<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>

    <style>
        /* 이용 전 (ACTIVE) - 초록색 */
        .ACTIVE {
            background-color: lightgreen;
        }

        /* 이용 완료 (COMPLETED) - 회색 */
        .COMPLETED {
            background-color: lightgray;
        }

        /* 취소 요청 (CANCELLATION_REQUESTED) - 빨간색 */
        .CANCELLATION_REQUESTED {
            background-color: red;
            color: white;
        }

        /* 취소됨 (CANCELLED) - 가로줄 */
        .CANCELLED {
            text-decoration: line-through;
        }
    </style>
</head>

<body>
<div layout:fragment="content">
    <div class="container-fluid px-4">
        <h1 class="mt-4">예약자 목록</h1>
        <ol class="breadcrumb mb-4">
            <div class="row mat-25">
                <table class="table mb-5">
                    <thead>
                    <tr>
                        <th scope="col">예약상태</th>
                        <th scope="col">예약번호</th>
                        <th scope="col">이름</th>
                        <th scope="col">전화번호</th>
                        <th scope="col">예약날짜</th>
                        <th scope="col">체크인</th>
                        <th scope="col">체크아웃</th>
                        <th scope="col">요청사항</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="reservation : ${list}" th:class="${reservation.status.name()}">
                        <td>
                            <span th:if="${reservation.status.name() == 'AVAILABLE'}">예약 가능</span>
                            <span th:if="${reservation.status.name() == 'ACTIVE'}">이용 전</span>
                            <span th:if="${reservation.status.name() == 'COMPLETED'}">이용 완료</span>
                            <span th:if="${reservation.status.name() == 'CANCELLATION_REQUESTED'}">취소 요청됨</span>
                            <span th:if="${reservation.status.name() == 'CANCELLED'}">취소됨</span>
                        </td>
                        <td th:text="${reservation.rvno}"></td>
                        <td th:text="${reservation.memberDTO.username}"></td>
                        <td th:text="${reservation.memberDTO.tel}"></td>
                        <td th:text="${#temporals.format(reservation.regTime, 'yyyy/MM/dd')}"></td>
                        <td th:text="${#temporals.format(reservation.startDate, 'yyyy/MM/dd')}"></td>
                        <td th:text="${#temporals.format(reservation.endDate, 'yyyy/MM/dd')}"></td>
                        <td th:text="${reservation.message}"></td>
                        <td>
                            <div th:if="${reservation.status.name() == 'CANCELLATION_REQUESTED'}">
                                <button type="button" th:onclick="'confirmCancellation(' + ${reservation.rvno} + ');'">취소 승인</button>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </ol>
    </div>

    <script>
        function confirmCancellation(rvno) {
            console.log("confirmCancellation 호출됨, rvno: " + rvno); // 로그 찍기
            if (confirm("이 예약을 취소하시겠습니까?")) {
                // 서버에 취소 승인 요청을 보냄
                console.log("취소 승인 요청, rvno: " + rvno); // 로그 찍기
                window.location.href = '/seller/cancellation/approval/' + rvno;
            }
        }
    </script>
</div>

</body>

</html>