<!doctype html>
<!--<link href="/css/main.css" rel="stylesheet">-->

<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments/fragment :: head">
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<style>
    /*Box 크기 체크용*/
    /*.crewBoxParent, .collapse, .btnBar, .boxTest {*/
    /*    background-color: #585858;*/
    /*    border:3px solid red;*/
    /*}*/

    /*타이핑*/
    .typeText::after {
        content: "|";
        animation: blink 1s step-end infinite;
    }

    @keyframes blink {
        0% {
            opacity: 1;
        }
        49% {
            opacity: 1;
        }
        50% {
            opacity: 0;
        }
        100% {
            opacity: 0;
        }
    }


    /*긴 문자 처리*/
    .text-strict {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 50%;
    }

    .text-strict2 {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 30%;
    }

    .card-title {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #333838;
        width: 90%;
        margin-top: 1%;
        margin-bottom: 2%;
    }

    .card-text {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #323334;
        width: 100%;
        margin-bottom: 2%;
    }

    .card-body {
        background-color: rgba(248, 253, 253, 0.98);
    }

    /*검색바*/
    .searchBar {
        width: 100%;
        position: center;
    }

    .searchBar2 {
        width: 80%;
        margin-left: 10%;
        margin-top: 7%;
        position: center;
        border-radius: 5px;
        box-shadow: 0 4px 10px rgb(39, 172, 255),
        0 5px 5px rgba(0, 0, 0, 0.22);
        border: rgba(1, 27, 86, 0.94);
    }

    .btnBar {
        width: 100%;
        margin-left: 0%;
    }

    /*운동선책 버튼 무빙 효과*/
    .btn-jittery {
        animation: jittery 8s infinite;
    }

    @keyframes jittery {
        5%,
        50% {
            transform: scale(1);
        }

        10% {
            transform: scale(0.9);
        }

        15% {
            transform: scale(1.15);
        }

        20% {
            transform: scale(1.15) rotate(-5deg);
        }

        25% {
            transform: scale(1.15) rotate(5deg);
        }

        30% {
            transform: scale(1.15) rotate(-3deg);
        }

        35% {
            transform: scale(1.15) rotate(2deg);
        }

        40% {
            transform: scale(1.15) rotate(0);
        }
    }

    /*운동선택 버튼*/
    .btn3 {
        width: 27%;
    }

    .btn.cyan {
        height: 90%;
        width: 40%;
        background-color: #147fd3;
        box-shadow: 0px 4px 3px #093ed2;
        padding: 8px 18px;
        font-size: 16px;
        color: white;
    }

    .btn-gradient.cyan {
        background: rgb(52, 151, 218);
        background: -webkit-linear-gradient(to right, #27d7ff, #4176fc);
        background: linear-gradient(to right, #27d7ff, #4176fc);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#1bbcc2', endColorstr='#18a3a8', GradientType=0);
    }

    . btn-outline-danger {
        height: 65%;
        width: 100%;
        padding: 8px 18px;
    }

    /*랜덤매칭 버튼*/
    .btn-random{
        width: 40%;
    }

    /*랜덤매칭 text*/
    .btn-random-text{
        margin-top: 1.5%;
        text-align : center;
    }

    /*모임등록 버튼*/
    .btn-crewAdd {
        width: 13%;
    }

    .btn.blue {
        height: 90%;
        width: 100%;
        background-color: #147fd3;
        box-shadow: 0px 4px 3px #093ed2;
        padding: 8px 18px;
        font-size: 16px;
        color: white;
    }

    .btn.blue:active {
        box-shadow: 0 0 #74a3b0;
        background-color: #709CA8;
    }

    .btn-gradient.blue {
        background: rgb(24, 71, 119);
        background: -webkit-linear-gradient(to right, #27d7ff, #4176fc);
        background: linear-gradient(to right, #27d7ff, #4176fc);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#6698cb', endColorstr='#5c8ab8', GradientType=0);
    }

    /*운동 체크박스*/
    .collapse {
        width: 100%;
        margin: 0px;
        padding: 0px;
    }

    .collapse-body {
        width: 96%;
        position: center;
        margin: 2%;
        padding: 2%;
        border-radius: 10px;
    }

    .checkBox-sport {
        box-shadow: 0px 5px 5px rgba(101, 130, 138, 0.71),
        0 5px 5px rgba(0, 0, 0, 0.22);
        color: rgba(0, 30, 30, 0.76);
        font-size: 1.1em;
    }

    /*체크박스 사이즈 조절*/
    input[type=checkbox] {
        -ms-transform: scale(1.5); /* IE */
        -moz-transform: scale(1.5); /* FF */
        -webkit-transform: scale(1.5); /* Safari and Chrome */
        -o-transform: scale(1.5); /* Opera */
        margin-right: 4px;
        padding: 10px;
    }


    .w-btn {
        position: relative;
        border: none;
        display: inline-block;
        padding: 10px 20px;
        border-radius: 15px;
        box-shadow: 0 5px 5px rgba(0, 0, 0, 0.2);
        text-decoration: none;
        font-weight: 600;
        font-size: 1em;
        transition: 0.25s;
    }

    .btnBox-incheckBox {
        margin-top: 3%;
    }

    /*운동체크박스 체크 후 조회 버튼*/
    .w-btn-indigo {
        background-color: rgb(37, 225, 255);
        color: #01264b;
    }

    /*My운동종목 버튼*/
    .w-btn:hover {
        letter-spacing: 2px;
        transform: scale(1.2);
        cursor: pointer;
    }

    .w-btn:active {
        transform: scale(1.5);
    }

    .w-btn-gra1 {
        background: linear-gradient(-45deg, #2b67ff 0%, #2edff6 100%);
        color: white;
    }

    .w-btn-gra-anim {
        background-size: 400% 400%;
        animation: gradient1 5s ease infinite;
    }

    @keyframes gradient1 {
        0% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
        100% {
            background-position: 0% 50%;
        }
    }

    @keyframes gradient2 {
        0% {
            background-position: 100% 50%;
        }
        50% {
            background-position: 0% 50%;
        }
        100% {
            background-position: 100% 50%;
        }
    }

    @keyframes ring {
        0% {
            width: 30px;
            height: 30px;
            opacity: 1;
        }
        100% {
            width: 300px;
            height: 300px;
            opacity: 0;
        }
    }

    /*크루 모집글 박스*/
    .crewBoxParent {
        width: 100%;
        margin: 0px auto;
        padding-bottom: 1%;
        overflow: auto;
    }

    .crewBox {
        background-color: rgba(248, 253, 253, 0.98);
        border-radius: 20px;
        box-shadow: 5px 5px 5px 5px rgba(101, 130, 138, 0.71),
        0 5px 5px rgba(0, 0, 0, 0.22);
        position: center;
        overflow: auto;
        width: 31.3%;
        border: rgba(63, 122, 254, 0.7);
        padding: 0.7%;
        margin: 1%;
    }

    .participation {
        color: black;
    }

    /*크루 사진*/
    .img-thumbnail {
        width: 100%;
        height: 225px;
        border-radius: 20px;
        margin-bottom: 7px;
    }






</style>


<body>
    <!-- 네비바-->
    <header th:replace="fragments/fragment :: nav"></header>
    <script th:inline="javascript" type="text/javascript" src="/js/main.js"></script>

    <main>
        <!-- 소개-->
        <section class="py-5 text-center container ">
            <!--    <section class="py-5 text-center">-->
            <div class="row py-lg-5">
                <div class="col-lg-6 col-md-8 mx-auto">
                    <div class="">
                        <h1 style="display:inline;">Connec</h1>
                        <h1 style="display:inline;" class="typeText"></h1>
                    </div>
                    <p class="lead text-muted">
                        <br>
                        ConnecTravel로 함께 즐기고, <br>
                        근처 투숙객과 친구가 되어 보세요.
                    </p>
                    <div class="searchBar">
                        <form class="row searchBar2" role="search" th:object="${sportRequest}" th:action="@{/view/v1/crews}" method="get" name="findAllCrewWithStrict">
                            <input type="search" th:field="*{strict}" class="form-control form-control-dark text-bg-blue" placeholder="관심 있는 지역을 검색해 보세요" aria-label="Search">
                            <input type="hidden" th:field="*{loginStatus}" th:value="${sportRequest.loginStatus}">
                            <input type="hidden" th:field="*{sportsList}" th:value="${sportRequest.getSportsList()}">
                        </form>
                    </div>

                </div>
            </div>
        </section>
        <div class="album py-5 bg-light">
            <div class="container">
                <!-- 운동 종목 데이터 확인-->
                <!--            <label th:text="|userSportsList : ${userSportsList}|"></label><br>-->
                <!--            <label th:text="|sportRequest.getSportsList() : ${sportRequest.getSportsList()}|"></label>-->

                <!-- 운동종목&랜덤매칭&모임등록 버튼-->
                <div class="btnBar row row-cols-1 row-cols-sm-4 row-cols-md-5 g-col-4">
                    <div class="btn3 boxTest">
                        <button class="btn btn-gradient cyan btn-jittery" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                            <strong>Like 운동</strong>
                        </button>
                    </div>
                    <div></div>
                    <div class="boxTest btn-random gap-3 d-md-flex justify-content-md-end">
                        <p><div class="btn-random-text" id="randomCnt" sec:authorize="isAuthenticated()"  th:text="${randomCnt}">현제 대기중인 인원 : </div></p>
                        <button class="btn btn-danger" style="display: none" type="button" id="randomMatchCancel_btn"
                                onclick="randomMatchCancel()">
                            + 실시간 매칭 취소🌌
                        </button>
                        <button class="btn btn-outline-danger" sec:authorize="isAuthenticated()" type="button" id="randomMatch_btn" onclick="randomMatch()">
                            + 실시간 매칭🔥
                        </button>
                    </div>
                    <div class="boxTest btn-crewAdd">
                        <button class="btn btn-gradient blue" sec:authorize="isAuthenticated()"  type="button" onclick="location.href='/view/v1/crews/write'">
                            <strong>+ 모임 등록</strong>
                        </button>
                    </div>
                </div>

                <!-- 운동종목 체크박스-->
                <div class="collapse" id="collapseExample">
                    <div class="card card-body collapse-body">
                        <form th:action method="get" th:object="${sportRequest}" id="btn-sports">
                            <input type="hidden" th:field="*{loginStatus}" th:value="${sportRequest.loginStatus}">
                            <input type="hidden" th:field="*{strict}" th:value="${sportRequest.getStrict()}">
                                <div class="grid text-center">
                                    <div class="row row-cols-1 row-cols-sm-4 row-cols-md-5 g-4">
                                        <label class="checkBox-sport btn btn-outline-info" th:each="sport : ${sportEnums}">
                                            <input type="checkbox"
                                                   onclick="count_check(this)"
                                                   th:field="*{sportsList}"
                                                   th:value="${sport}"
                                                   th:text="${sport.getValue()}">
                                        </label>
                                    </div>
                                    <div class="btnBox-incheckBox row justify-content-end">
                                        <div class="col-8">
                                            <button class="w-btn w-btn-indigo" type="submit">
                                                운동 조회
                                            </button>
                                        </div>
                                        <div class="col-2">
                                                <button class="w-btn w-btn-gra1 w-btn-gra-anim" type="button"  onclick="location.href='/view/v1/crews'">
                                                    My운동종목
                                                </button>
                                        </div>
                                    </div>
                                </div>
                        </form>
                    </div>
                </div>

                <!-- 앨범-->
                <div class="crewBoxParent row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3 ">
                    <div class="col crewBox" th:each="crew : ${crewList}">
                        <a class="link-light" th:href="@{/view/v1/crews/{crewId}(crewId = ${crew.id},
                                                                                   page = (${nowPage} - 1) * 9 + ${crewStat.index},
                                                                                   loginStatus = ${sportRequest.loginStatus},
                                                                                   strict = ${sportRequest.getStrict()},
                                                                                   sportsList = ${sportRequest.getSportsList()}
                                                                                   )}">
                            <small class="text-muted" type="hidden" th:value="${crewStat.index}"></small>

                            <input type="hidden" name="img-key" th:id="${crew.id}+' imageKey'" th:value="${crew.imagePath}">


                            <img class="img-thumbnail" style="width:100%; height:225px;" th:id="${crew.id}+' imageId'">


<!--                            <input hidden th:value="${AWS_ACCESS_KEY}" id="awsAccessKey">-->
<!--                            <input hidden th:value="${AWS_SECRET_ACCESS_KEY}" id="awsSecretAccessKey">-->
<!--                            <input hidden th:value="${AWS_REGION}" id="awsRegion">-->
<!--                            <input hidden th:value="${AWS_BUCKET_NAME}" id="awsBucketName">-->
<!--                            <input hidden th:value="${AWS_BUCKET_DIRECTORY}" id="awsBucketDirectory">-->

                            <script type="text/javascript" th:inline="javascript">

                                console.log([[${crew.id}]]+' imageKey');
                                console.log([[${crew.id}]]+' imageId');


                                var imgKey = document.getElementById([[${crew.id}]]+ ' imageKey').value;
                                var imgId = [[${crew.id}]]+ ' imageId';

                                profileGet(imgKey, imgId);

                                async function profileGet(imgKey, imgId) {

                                    // let uuidString = Math.random().toString(20).substr(2,8);

                                    const ACCESS_KEY = document.getElementById("awsAccessKey").value;
                                    const SECRET_ACCESS_KEY = document.getElementById("awsSecretAccessKey").value;
                                    const REGION = document.getElementById("awsRegion").value;
                                    const BUCKET_NAME = document.getElementById("awsBucketName").value;
                                    const BUCKET_DIRECTORY = document.getElementById("awsBucketDirectory").value;
                                    const S3_BUCKET = BUCKET_NAME + BUCKET_DIRECTORY;


                                    // AWS ACCESS KEY를 세팅합니다.

                                    AWS.config.update({
                                        accessKeyId: ACCESS_KEY,
                                        secretAccessKey: SECRET_ACCESS_KEY
                                    });

                                    var s3 = new AWS.S3({
                                        region: REGION
                                    });

                                    // var imgKey = $('input[name=img-key]').val();

                                    if (!imgKey) {
                                        imgKey = '4f9e2be2-7e04-4aa8-bde0-ac2c4df64fcd-blank-profile-picture-g7d902ce67_1280.png'
                                    }

                                    // 'e44091b4-4c0a-439c-98b1-086773f65f85-lighthouse.png'


                                    const params = {
                                        Bucket: S3_BUCKET,
                                        Key: imgKey
                                    };

                                    var url = s3.getSignedUrl(
                                        "getObject", params
                                    );

                                    // const img1 = document.getElementById('left-image');
                                    // img1.src = url;

                                    console.log("imageId:{ }", imgId);

                                    document.getElementById(imgId).src = url;

                                }


                            </script>


                            <div class="card-body">
                                <div class="">
                                    <h3 class="card-title" th:text="${crew.title}">제목</h3>
                                    <p class="card-text" th:text="${crew.content}">내용</p>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted text-strict" th:text="${crew.strict}">지역</small>
                                    <small class="text-muted text-strict2" ></small>
                                    <small class="participation text-muted" th:id="${crew.id}">
                                        <script th:inline="javascript">
                                            findPart([[${crew.id}]]);
                                        </script>
                                    </small>
                                    <small class="text-muted"> / [(${crew.crewLimit})] 명</small>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>


            </div>
        </div>

        <!-- 하단 페이징-->
        <div class="py-3 my-4">
            <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${1 == nowPage} ? 'disabled'">
                        <a class="page-link" th:href="@{/view/v1/crews(page = ${nowPage - 2},
                                                                               strict=${sportRequest.getStrict()},
                                                                               loginStatus = ${sportRequest.loginStatus},
                                                                               sportsList=${sportRequest.getSportsList()})}">Previous</a>
                    </li>
                    <th:block th:each="page : ${#numbers.sequence(startNumPage, endNumPage)}">
                        <li class="page-item" th:if="${page != nowPage && page != 0}"><a class="page-link"
                                                                            th:href="@{/view/v1/crews(
                                                                                                page = ${page - 1},
                                                                                                loginStatus = ${sportRequest.loginStatus},
                                                                                                strict=${sportRequest.getStrict()},
                                                                                                sportsList=${sportRequest.getSportsList()}
                                                                                                )}" th:text="${page}">1</a>
                        </li>
                        <li class="page-item" th:if="${page == nowPage}"><strong class="page-link" th:text="${page}"
                                                                                 style="color: red"></strong></li>
                    </th:block>
                    <li class="page-item" th:classappend="${lastPage == nowPage || lastPage == 0} ? 'disabled'">
                        <a class="page-link" th:href="@{/view/v1/crews(page = ${nowPage},
                                                                               strict=${sportRequest.getStrict()},
                                                                               loginStatus = ${sportRequest.loginStatus},
                                                                               sportsList=${sportRequest.getSportsList()})}">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </main>

    <footer th:replace="fragments/fragment :: footer"></footer>

    <script type="text/javascript" src="/js/random.js"></script>


<!--    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"-->
<!--            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"-->
<!--            crossorigin="anonymous"></script>-->


    <script type="text/javascript" th:inline="javascript">


        // async function profileGet(imgKey, imgId) {
        //
        //     // let uuidString = Math.random().toString(20).substr(2,8);
        //
        //     const ACCESS_KEY = document.getElementById("awsAccessKey").value;
        //     const SECRET_ACCESS_KEY = document.getElementById("awsSecretAccessKey").value;
        //     const REGION = document.getElementById("awsRegion").value;
        //     const BUCKET_NAME = document.getElementById("awsBucketName").value;
        //     const BUCKET_DIRECTORY = document.getElementById("awsBucketDirectory").value;
        //     const S3_BUCKET = BUCKET_NAME + BUCKET_DIRECTORY;
        //
        //
        //     // AWS ACCESS KEY를 세팅합니다.
        //
        //     AWS.config.update({
        //         accessKeyId: ACCESS_KEY,
        //         secretAccessKey: SECRET_ACCESS_KEY
        //     });
        //
        //     var s3 = new AWS.S3({
        //         region: REGION
        //     });
        //
        //     // var imgKey = $('input[name=img-key]').val();
        //
        //     if (!imgKey) {
        //         imgKey = '4f9e2be2-7e04-4aa8-bde0-ac2c4df64fcd-blank-profile-picture-g7d902ce67_1280.png'
        //     }
        //
        //     // 'e44091b4-4c0a-439c-98b1-086773f65f85-lighthouse.png'
        //
        //
        //     const params = {
        //         Bucket: S3_BUCKET,
        //         Key: imgKey
        //     };
        //
        //     var url = s3.getSignedUrl(
        //         "getObject", params
        //     );
        //
        //     // const img1 = document.getElementById('left-image');
        //     // img1.src = url;
        //
        //     document.getElementById(imgId).src = url;
        //
        //
        //
        // }

        // 타이핑 효과
        var typeText = document.querySelector(".typeText")
        var textToBeTyped = "Connec Travel"
        var textToBeTypedArr = ["T", "\0Travel!"]
        var index = 0, isAdding = true, textToBeTypedIndex = 0

        function playAnim() {
            setTimeout(function () {
                // set the text of typeText to a substring of the text to be typed using index.
                typeText.innerText = textToBeTypedArr[textToBeTypedIndex].slice(0, index)
                if (isAdding) {
                    // adding text
                    if (index > textToBeTypedArr[textToBeTypedIndex].length) {
                        // no more text to add
                        isAdding = false
                        //break: wait 2s before playing again
                        setTimeout(function () {
                            playAnim()
                        }, 2500)
                        return
                    } else {
                        // increment index by 1
                        index++
                    }
                } else {
                    // removing text
                    if (index === 0) {
                        // no more text to remove
                        isAdding = true
                        //switch to next text in text array
                        textToBeTypedIndex = (textToBeTypedIndex + 1) % textToBeTypedArr.length
                    } else {
                        // decrement index by 1
                        index--
                    }
                }
                // call itself
                playAnim()
            }, isAdding ? 200 : 150)
        }

        // start animation
        playAnim()

        // GetMapping에서 데이터 조회 완료 후 url로 파라미터 삭제
        // history.replaceState({}, null, location.pathname);

        // 운동 종목 체크박스 3개 초과 시 알람
        function count_check(obj) {

            var chkBox = document.getElementById("btn-sports");
            var chkCnt = 0;

            for (var i = 0; i < chkBox.length; i++) {
                if (chkBox[i].checked) {
                    chkCnt++;
                }
            }
            if (chkCnt > 3) {
                alert("최대 3개 체크 가능합니다.");
                obj.checked = false;
                return false;
            }
        }
    </script>

</body>
</html>
